# Project Status

**Last Updated:** 2025-11-25
**Status:** ðŸŸ¢ Active

---

## ðŸ“Š Quick Reference

_(This section is auto-generated by /save and /save-full - DO NOT edit manually)_

**Project:** AI Prompt Library
**Phase:** Phase 3 - Polish & Launch (Complete) + Copy Preferences Enhancement
**Status:** ðŸŸ¢ Active - Production Features Ready

**URLs:**

- Production: https://prompt-library-alpha-inky.vercel.app/
- Staging: N/A (preview deployments via Vercel)
- Repository: https://github.com/rexkirshner/prompt-library

**Tech Stack:** Next.js 16, React 19, TypeScript, Prisma 7, PostgreSQL 17, NextAuth.js v5, Tailwind CSS v4

**Commands:**

```bash
npm run dev -- -p 3001  # Development server (port 3001)
npm test                # Run tests (Jest)
npm run build           # Production build
npm run db:migrate      # Run Prisma migrations
npm run test:db         # Test database connection
```

**Current Focus:** Per-prompt copy preferences system with database-backed storage

**Last Session:** [Session 10 - 2025-11-25](SESSIONS.md#session-10---2025-11-25)

**Documentation Health:** ðŸŸ¢ Excellent

- Last validated: Today
- Stale files: 0
- All features documented including per-prompt preferences

[Full report: Run /validate-context]

---

## Current Phase

**Phase:** Phase 3 - Polish & Launch
**Started:** 2025-01-24 (Session 8)
**Status:** âœ… Complete

**Focus:** Production readiness - error handling, loading states, legal compliance, SEO, performance, UX polish

## Active Tasks

**In Progress:** None - All tasks complete âœ…

**Completed This Session (Session 10 - Per-Prompt Copy Preferences):**

**Per-Prompt Copy Preferences System:**
- [âœ…] Created user_prompt_preferences database table
- [âœ…] Implemented server actions for per-prompt storage (lib/prompts/copy-preferences.ts)
- [âœ…] Updated CopyButton to use prompt-specific settings
- [âœ…] Created CopyPreview component for real-time preview
- [âœ…] Added Ultrathink and GitHub reminder options
- [âœ…] Removed GlobalSettings (replaced by per-prompt approach)
- [âœ…] Settings persist across prompt detail and list views
- [âœ…] Database storage for logged-in users
- [âœ…] localStorage with prompt-specific keys for anonymous users

**Authentication & UI Fixes:**
- [âœ…] Fixed broken /auth/login links (changed to /auth/signin)
- [âœ…] Added dark mode support to signin/signup pages
- [âœ…] Migrated from useFormState to useActionState (React 19)
- [âœ…] Created admin password management scripts

**Next Up (Awaiting User Direction):**

- [ ] Manual UI testing of copy preferences
- [ ] Review copy preview functionality
- [ ] GitHub push & deployment decision (36 commits ahead)
- [ ] Phase 4 planning or additional features

## Blockers & Decisions

**Current Blockers:**

- None

**Recent Decisions:**

- **Authentication:** Email/password via NextAuth.js v5 (avoid Google OAuth approval)
- **Session Strategy:** JWT tokens (required for Credentials provider)
- **Password Security:** Bcrypt with 12 salt rounds
- **Content License:** CC0 (Public Domain) for all submissions
- **Moderation:** Manual review for all submissions (small scale)
- **Tech Stack:** Next.js 16, React 19, PostgreSQL 17, Prisma 7, Vercel

**Pending Decisions:**

- UI component library specifics
- Sign-up form validation rules
- Email verification for new accounts (Phase 2+)

## Work In Progress

**Current Task:** Implementing invite-only registration system

**Current Files:**

- `lib/invites/` - Invite system module (validation, actions, types) âœ…
- `scripts/create-first-admin.ts` - Bootstrap script âœ…
- `prisma/schema.prisma` - invite_codes table âœ…
- Next: Admin invite generation UI
- Next: Update signup flow to require invites

**Progress:**
- 26 commits ahead of origin/main (21 from Phase 3 + 5 from invite system)
- Database migration applied successfully
- Invite module complete with comprehensive documentation

**Mental Model:**

**Invite-Only Registration System:**

Implementing admin-controlled registration to maintain community quality. System prevents public signup - all new users need invite codes generated by admins.

Architecture:
1. **Database:** `invite_codes` table with one-time use enforcement (unique constraint on `used_by`)
2. **Module:** `lib/invites/` provides validation, CRUD operations, and statistics
3. **Bootstrap:** CLI script creates first admin (bypasses invite requirement)
4. **Tracking:** `users.invited_by` creates provenance chain for moderation

Key design decisions:
- UUID codes (unguessable, no enumeration attacks)
- One-time use enforced at DB level (`used_by @unique`)
- Admin-only creation (no limits, trusted admins)
- Invite chain tracking enables moderation (ban bad actor â†’ see who they invited)

**Next Specific Actions:**

1. Build admin UI for invite generation (`/admin/invites`)
2. Update signup flow to require `?invite=CODE` parameter
3. Add validation to signup server action
4. Fix Jest environment loading for tests
5. Test full invite flow end-to-end

## Recent Accomplishments

**Current Session (Session 10 - 2025-11-25):**

**Per-Prompt Copy Preferences System:**
- âœ… Database architecture: Created `user_prompt_preferences` table with unique constraint on (user_id, prompt_id)
- âœ… Server actions: `getPromptCopyPreferences()` and `savePromptCopyPreferences()` with upsert pattern
- âœ… CopyButton: Refactored to use prompt-specific localStorage keys and database storage
- âœ… CopyPreview: New component showing real-time preview of final copy output
- âœ… Settings persistence: Different settings per prompt, synced across pages
- âœ… Storage strategy: Database for logged-in users, localStorage for anonymous
- âœ… New options: Ultrathink and GitHub reminder checkboxes

**Authentication & UI Fixes:**
- âœ… Fixed 404 on /auth/login (updated to /auth/signin across 3 files)
- âœ… Dark mode for signin/signup pages (comprehensive Tailwind classes)
- âœ… React 19 migration: useFormState â†’ useActionState
- âœ… Admin scripts: check-admins.ts and reset-admin-password.ts

**Database Migrations:**
- âœ… Migration 1: Add copy preferences to users table (prefix, suffix, booleans)
- âœ… Migration 2: Add ultrathink and GitHub reminder fields
- âœ… Migration 3: Create user_prompt_preferences table (per-prompt storage)

**Key Files Created:**
- `lib/prompts/copy-preferences.ts` - Server actions for per-prompt preferences
- `components/CopyPreview.tsx` - Real-time copy preview component
- `components/GlobalSettings.tsx` - (Created but no longer used, kept for reference)
- `lib/users/actions.ts` - User copy preferences actions
- `scripts/check-admins.ts` - Admin account verification
- `scripts/reset-admin-password.ts` - Password reset utility
- `prisma/migrations/20251125041630_create_user_prompt_preferences/` - Per-prompt table

**Key Files Modified:**
- `components/CopyButton.tsx` - Now uses prompt-specific keys and database
- `components/PromptsListClient.tsx` - Added userId prop for database preferences
- `app/prompts/page.tsx` - Removed GlobalSettings, passes userId to list
- `app/prompts/[slug]/page.tsx` - Updated CopyPreview with promptId
- `prisma/schema.prisma` - Added user_prompt_preferences model

## Next Session

**Priority 1:** User testing and review
- Manual UI testing of per-prompt copy preferences
- Test copy preview functionality with different settings
- Verify settings persist across navigation
- Test database storage vs localStorage

**Priority 2:** Deployment decision
- Push 36 commits to GitHub (requires explicit approval)
- Deploy to production
- Monitor copy feature usage

**Priority 3:** Phase 4 planning
- Discuss next priorities
- Review PRD for Phase 4 features
- Consider additional UX enhancements

**Context Notes:**

- Per-prompt copy preferences fully implemented âœ…
- 36 commits ahead of origin/main - ready to push
- All features working - server running on port 3001
- Database migrations applied successfully
- Copy settings now prompt-specific with database backing
- Dev server running: http://localhost:3001
- Docker PostgreSQL running on port 54320

---

**Last Updated:** 2025-11-25
**Session:** Session 10
